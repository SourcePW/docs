# 漏扫问题修改

通过nessus扫描的漏洞及解决方案:
## SSL Certificate Signed Using Weak Hashing Algorithm
SHA1WithRSA算法不安全，需要更换为SHA256WithRSA，需要更新签名证书 

## SSL Medium Strength Cipher Suites Supported (SWEET32)
ssl加密算法问题，需要修改nginx.conf中ssl加密算法问题

## SSL Certificate Cannot Be Trusted
## TLS Version 1.0 Protocol Detection
## TLS Version 1.1 Protocol Deprecated
需要更新TLS的版本`ssl_protocols  TLSv1.2;`  

## AMQP Cleartext Authentication
关闭防火墙的其他端口

## SSH Weak Algorithms Supported


查看支持的协议:
```
sshd -T | grep kex

gssapikexalgorithms gss-gex-sha1-,gss-group1-sha1-,gss-group14-sha1-
kexalgorithms diffie-hellman-group-exchange-sha256,diffie-hellman-group-exchange-sha1,diffie-hellman-group14-sha1,diffie-hellman-group1-sha1
```

`vim /etc/ssh/sshd_config`
```shell
Ciphers aes128-ctr,aes192-ctr,aes256-ctr
MACs hmac-sha1,hmac-ripemd160
KexAlgorithms diffie-hellman-group-exchange-sha256,diffie-hellman-group-exchange-sha1,diffie-hellman-group14-sha1,diffie-hellman-group1-sha1
```

重启`service sshd restart`
## SSL Self-Signed Certificate

修改配置:
```

```

`/etc/nginx/nginx.conf`配置修改:

```
...
http {
    default_type  application/octet-stream;
    init_worker_by_lua_file /opt/**;
    ssl_protocols  TLSv1.2;
    ssl_ciphers 'ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-AES256-GCM-SHA384:DHE-RSA-AES128-GCM-SHA256:DHE-DSS-AES128-GCM-SHA256:kEDH+AESGCM:ECDHE-RSA-AES128-SHA256:ECDHE-ECDSA-AES128-SHA256:ECDHE-RSA-AES128-SHA:ECDHE-ECDSA-AES128-SHA:ECDHE-RSA-AES256-SHA384:ECDHE-ECDSA-AES256-SHA384:ECDHE-RSA-AES256-SHA:ECDHE-ECDSA-AES256-SHA:DHE-RSA-AES128-SHA256:DHE-RSA-AES128-SHA:DHE-DSS-AES128-SHA256:DHE-RSA-AES256-SHA256:DHE-DSS-AES256-SHA:DHE-RSA-AES256-SHA:AES128-GCM-SHA256:AES256-GCM-SHA384:AES128-SHA256:AES256-SHA256:AES128-SHA:AES256-SHA:AES:CAMELLIA:!DES-CBC3-SHA:!aNULL:!eNULL:!EXPORT:!DES:!RC4:!MD5:!PSK:!aECDH:!EDH-DSS-DES-CBC3-SHA:!EDH-RSA-DES-CBC3-SHA:!KRB5-DES-CBC3-SHA';
    server {
        ...


```  
修改后重启nginx服务`nginx -s reload`  


更新防火墙配置`/etc/sysconfig/iptables`为:
```
# Generated by iptables-save v1.4.7 on Mon Jan 14 11:01:39 2019
*filter
:INPUT ACCEPT [0:0]
:FORWARD ACCEPT [0:0]
:OUTPUT ACCEPT [14:2552]
-A INPUT -m state --state RELATED,ESTABLISHED -j ACCEPT 
-A INPUT -i lo -j ACCEPT 
-A INPUT -p icmp -j ACCEPT 
-A INPUT -p tcp -m state --state NEW -m tcp --dport 22 -j ACCEPT 
-A INPUT -p tcp -m state --state NEW -m tcp --dport 443 -j ACCEPT
-A INPUT -p tcp -m state --state NEW -m tcp --dport 123 -j ACCEPT
-A INPUT -j REJECT --reject-with icmp-host-prohibited 
-A FORWARD -j REJECT --reject-with icmp-host-prohibited 
COMMIT
# Completed on Mon Jan 14 11:01:39 2019
```

重启防火墙`service iptables restart`


## SSL证书
查看具体信息: 

```
签发者信息
邮箱地址	support@**.com
组织(O)	Beijing ** Technology Co., Ltd.
部门(OU)	**
城市(L)	**
省份(ST)	**
国家(C)	CN


证书信息
序列号	**
根证书	是
算法	SHA1WithRSA
证书类型	OV
证书品牌	Other
私钥长度	4096 Bits
SHA1指纹	**
SHA256指纹	**
公钥PIN-SHA256	**/Avyozs3Nw=
颁发日期	2018-04-29 11:05:46
截止日期	2038-04-29 11:05:46
有效期	5805天
```

